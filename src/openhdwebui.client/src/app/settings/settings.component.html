<div class="settings">
  <h2>Settings</h2>

  <section class="card">
    <h3>Theme</h3>
    <label class="toggle">
      <input type="checkbox" (change)="onThemeToggle()" [checked]="themeService.isDark">
      <span>Dark mode</span>
    </label>
  </section>

  <section class="card network-card" *ngIf="network">
    <div class="network-header">
      <div>
        <h3>Network</h3>
        <p class="description">Review available interfaces and update static settings for your wired connections.</p>
      </div>
      <div class="badge-group">
        <span class="badge" *ngIf="wifiInterfaces.length">WiFi: {{ wifiInterfaces.length }}</span>
        <span class="badge" *ngIf="ethernetInterfaces.length">Ethernet: {{ ethernetInterfaces.length }}</span>
      </div>
    </div>

    <div class="network-grid">
      <div class="network-panel">
        <div class="panel-header">
          <h4>WiFi Interfaces</h4>
          <p class="panel-subtitle">Detected wireless adapters with their corresponding drivers.</p>
        </div>
        <table *ngIf="wifiInterfaces.length; else noWifi">
          <thead>
            <tr>
              <th scope="col">Interface</th>
              <th scope="col">Driver</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let wifi of wifiInterfaces">
              <td data-label="Interface">{{ wifi.name }}</td>
              <td data-label="Driver">{{ wifi.driver || 'Unknown' }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="network-panel">
        <div class="panel-header">
          <h4>Ethernet Interfaces</h4>
          <p class="panel-subtitle">Assign or update static IP details for wired links.</p>
        </div>
        <ng-container *ngIf="ethernetInterfaces.length; else noEthernet">
          <div class="ethernet-card" *ngFor="let eth of ethernetInterfaces">
            <header>
              <h5>{{ eth.name }}</h5>
              <span class="ethernet-hint">Current configuration</span>
            </header>
            <div class="ethernet-fields">
              <label>
                <span>IP address</span>
                <input type="text" [(ngModel)]="eth.ipAddress" placeholder="e.g. 192.168.1.10">
              </label>
              <label>
                <span>Netmask</span>
                <input type="text" [(ngModel)]="eth.netmask" placeholder="e.g. 255.255.255.0">
              </label>
            </div>
            <div class="ethernet-actions">
              <button type="button" (click)="saveEthernet(eth)">Save settings</button>
            </div>
          </div>
        </ng-container>
      </div>
    </div>

    <ng-template #noWifi>
      <p class="empty-state">No WiFi interfaces were detected.</p>
    </ng-template>
    <ng-template #noEthernet>
      <p class="empty-state">No Ethernet interfaces were found on this device.</p>
    </ng-template>
  </section>

  <section class="card settings-card">
    <div class="settings-header">
      <div>
        <h3>OpenHD configuration</h3>
        <p class="description">Select a JSON settings file from OpenHD and edit it directly in the browser.</p>
      </div>
      <div class="status" *ngIf="isLoadingSettings">Loading settings…</div>
      <div class="status error" *ngIf="settingsError">{{ settingsError }}</div>
    </div>

    <div class="settings-content" *ngIf="!settingsError">
      <div class="settings-list" [class.disabled]="isLoadingSettings">
        <p *ngIf="!isLoadingSettings && settingFiles.length === 0" class="empty">No settings files were found. Ensure OpenHD is installed and the settings directory is accessible.</p>
        <ng-container *ngFor="let group of groupedSettings">
          <h4>{{ group.title }}</h4>
          <ul>
            <li *ngFor="let file of group.items; trackBy: trackBySetting"
                (click)="selectSetting(file)"
                [class.active]="selectedSetting?.id === file.id">
              <span class="file-name">{{ file.name }}</span>
              <span class="file-path">{{ file.relativePath }}</span>
            </li>
          </ul>
        </ng-container>
      </div>

      <div class="settings-editor" *ngIf="selectedSetting">
        <div class="editor-header">
          <div>
            <h4>{{ selectedSetting.name }}</h4>
            <span class="editor-path">{{ selectedSetting.relativePath }}</span>
          </div>
          <div class="editor-status">
            <span class="info" *ngIf="isSavingFile">Saving…</span>
            <span class="info" *ngIf="isLoadingFile">Loading…</span>
            <span class="success" *ngIf="saveSuccess">Saved</span>
            <span class="error" *ngIf="fileError">{{ fileError }}</span>
          </div>
        </div>
        <textarea [(ngModel)]="selectedSetting.content" [disabled]="isLoadingFile || isSavingFile"></textarea>
        <div class="editor-actions">
          <button (click)="saveSelectedSetting()" [disabled]="isSavingFile">Save changes</button>
        </div>
      </div>

      <div class="settings-editor placeholder" *ngIf="!selectedSetting && !isLoadingSettings && settingFiles.length > 0">
        <p>Select a settings file to start editing its contents.</p>
      </div>
    </div>
  </section>
</div>
