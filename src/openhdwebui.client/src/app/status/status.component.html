<section class="status-page">
  <div class="status-hero">
    <div class="status-chip"
         [class.ok]="status?.hasData && !status?.hasError"
         [class.error]="status?.hasError">
      <span class="dot"></span>
      {{ statusBadge }}
    </div>

    <h1>OpenHD Status</h1>
    <p class="lead">{{ statusTitle }}</p>
  </div>

  <div class="status-grid">
    <article class="status-card"
             [class.ok]="status?.hasData && !status?.hasError"
             [class.error]="status?.hasError">
      <div class="card-header">
        <div class="icon">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 3v4m0 10v4M4.9 4.9l2.8 2.8m8.6 8.6 2.8 2.8M3 12h4m10 0h4M4.9 19.1l2.8-2.8m8.6-8.6 2.8-2.8"
                  fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <circle cx="12" cy="12" r="3.5" fill="none" stroke="currentColor" stroke-width="1.5"/>
          </svg>
        </div>
        <div>
          <h2>System State</h2>
          <p class="muted">{{ statusSummary }}</p>
        </div>
      </div>

      <div class="status-rows">
        <div class="status-row">
          <span class="label">State</span>
          <span class="value">{{ status?.state || 'Waiting for update' }}</span>
        </div>
        <div class="status-row">
          <span class="label">Description</span>
          <span class="value">{{ status?.description || '—' }}</span>
        </div>
        <div class="status-row">
          <span class="label">Message</span>
          <span class="value">{{ status?.message || '—' }}</span>
        </div>
        <div class="status-row">
          <span class="label">Severity</span>
          <span class="value">{{ status?.hasData ? status?.severity : '—' }}</span>
        </div>
        <div class="status-row">
          <span class="label">Last update</span>
          <span class="value">{{ formatTimestamp(status?.updatedMs) }}</span>
        </div>
      </div>
    </article>

    <article class="status-card secondary">
      <div class="card-header">
        <div class="icon soft">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M5 7h14M5 12h14M5 17h14" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
          </svg>
        </div>
        <div>
          <h2>Connection</h2>
          <p class="muted">WebUI connects to openhd_sys_utils over the Unix socket.</p>
        </div>
      </div>

      <div class="status-rows">
        <div class="status-row">
          <span class="label">Socket</span>
          <span class="value">{{ status?.isAvailable ? 'Connected' : 'Unavailable' }}</span>
        </div>
        <div class="status-row">
          <span class="label">Redirect</span>
          <span class="value">Status stays available from any tab.</span>
        </div>
      </div>
      <div class="status-error" *ngIf="status?.hasError">
        <h3>OpenHD errors detected</h3>
        <p class="muted">Review the latest status values and check logs in the Debug tab.</p>
      </div>

      <div class="status-history" *ngIf="errorHistory.length">
        <h3>Recent errors</h3>
        <div class="history-row" *ngFor="let entry of errorHistory">
          <div>
            <div class="history-title">
              {{ entry.description || entry.message || entry.state || 'Unknown error' }}
            </div>
            <div class="history-meta">
              Severity {{ entry.severity }} · {{ formatTimestamp(entry.updatedMs) }}
            </div>
          </div>
          <div class="history-state">{{ entry.state || '—' }}</div>
        </div>
      </div>
    </article>

    <article class="status-card secondary">
      <div class="card-header">
        <div class="icon soft">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M4 8h16M7 12h10M9 16h6" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            <circle cx="6" cy="8" r="1.5" fill="currentColor"/>
            <circle cx="18" cy="8" r="1.5" fill="currentColor"/>
            <circle cx="9" cy="12" r="1.5" fill="currentColor"/>
            <circle cx="15" cy="12" r="1.5" fill="currentColor"/>
            <circle cx="11" cy="16" r="1.5" fill="currentColor"/>
            <circle cx="13" cy="16" r="1.5" fill="currentColor"/>
          </svg>
        </div>
        <div>
          <h2>Live RF Control</h2>
          <p class="muted">Apply channel, bandwidth, MCS, and power on the fly.</p>
        </div>
      </div>

      <div class="control-form">
        <label class="form-field">
          <span>Interface (optional)</span>
          <input type="text" [(ngModel)]="rfControlForm.interfaceName" placeholder="wlan1">
        </label>
        <label class="form-field">
          <span>Channel (MHz)</span>
          <input type="text" inputmode="numeric" [(ngModel)]="rfControlForm.frequencyMhz" placeholder="e.g. 5180">
        </label>
        <label class="form-field">
          <span>Bandwidth (MHz)</span>
          <input type="text" inputmode="numeric" [(ngModel)]="rfControlForm.channelWidthMhz" placeholder="10 | 20 | 40">
        </label>
        <label class="form-field">
          <span>MCS index</span>
          <input type="text" inputmode="numeric" [(ngModel)]="rfControlForm.mcsIndex" placeholder="0 - 9">
        </label>
        <label class="form-field">
          <span>Power</span>
          <select [(ngModel)]="rfControlForm.powerLevel">
            <option value="">Keep current</option>
            <option value="lowest">Lowest</option>
            <option value="low">Low</option>
            <option value="mid">Mid</option>
            <option value="high">High</option>
          </select>
        </label>
      </div>

      <p class="muted">Leave a field blank to keep the current value.</p>
      <p class="success-text" *ngIf="rfControlSuccess">{{ rfControlSuccess }}</p>
      <p class="error-text" *ngIf="rfControlError">{{ rfControlError }}</p>

      <div class="actions">
        <button class="btn" (click)="applyRfControl()" [disabled]="rfControlSaving">
          {{ rfControlSaving ? 'Applying...' : 'Apply' }}
        </button>
      </div>
    </article>
  </div>

  <div class="status-footer">
    <p *ngIf="lastError" class="error-text">{{ lastError }}</p>
    <p class="hint">Auto-refreshes every 3 seconds.</p>
  </div>
</section>
